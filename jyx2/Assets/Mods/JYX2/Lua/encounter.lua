QuestList = {
    {id=1, diff="0", talk="근처에서 도적을 수배하고 있습니다.", role={221}, name="도적", item={0,2,3,11,96,201,206}, itemNum=1, money=50},
    {id=2, diff="0", talk="근처에서 강도를 수배하고 있습니다.", role={231}, name="강도", item={0,2,3,11,96,201,205}, itemNum=1, money=50},
    {id=3, diff="0", talk="근처에서 음적을 수배하고 있습니다.", role={241}, name="음적", item={0,2,3,11,96,201,203}, itemNum=1, money=50},
    {id=4, diff="0", talk="근처에서 산적을 수배하고 있습니다.", role={271}, name="산적", item={0,2,3,11,96,201,204}, itemNum=1, money=50},
    {id=5, diff="0", talk="근처에서 파계승을 수배하고 있습니다.", role={251}, name="파계승", item={0,2,3,11,96,201,202}, itemNum=1, money=50},
    {id=6, diff="1", talk="근처에서 도적 무리를 수배하고 있습니다.", role={221, 221, 221}, name="도적", item={0,2,3,11,96,201,206}, itemNum=2, money=100},
    {id=7, diff="1", talk="근처에서 강도 무리를 수배하고 있습니다.", role={231, 231, 231}, name="강도", item={0,2,3,11,96,201,205}, itemNum=2, money=100},
    {id=8, diff="1", talk="근처에서 음적 무리를 수배하고 있습니다.", role={241, 241, 241}, name="음적", item={0,2,3,11,96,201,203}, itemNum=2, money=100},
    {id=9, diff="1", talk="근처에서 산적 무리를 수배하고 있습니다.", role={271, 271, 271}, name="산적", item={0,2,3,11,96,201,204}, itemNum=2, money=100},
    {id=10, diff="1", talk="근처에서 파계승 무리를 수배하고 있습니다.", role={251, 251, 251}, name="파계승", item={0,2,3,11,96,201,202}, itemNum=2, money=100},
    {id=11, diff="2", talk="무당파에서 파문당한 제자를 수배하고 있는데, 근처에서 목격된 것 같습니다.", role={133}, name="파문제자", item={1,6,18,111}, itemNum=1, money=300},
    {id=12, diff="2", talk="아미파에서 파문당한 제자를 수배하고 있는데, 근처에서 목격된 것 같습니다.", role={149}, name="파문제자", item={1,3,18,111}, itemNum=1, money=300},
    {id=13, diff="2", talk="곤륜파에서 파문당한 제자를 수배하고 있는데, 근처에서 목격된 것 같습니다.", role={99}, name="파문제자", item={1,3,14,111}, itemNum=1, money=300},
    {id=14, diff="2", talk="공동파에서 파문당한 제자를 수배하고 있는데, 근처에서 목격된 것 같습니다.", role={158}, name="파문제자", item={1,4,18,201}, itemNum=1, money=300},
    {id=15, diff="2", talk="명교 출신의 제자가 마에 물들어 수배하고 있는데, 근처에서 목격된 것 같습니다.", role={310}, name="파문제자", item={1,3,18,111}, itemNum=1, money=300},
    {id=16, diff="2", talk="화산파에서 파문당한 제자를 수배하고 있는데, 근처에서 목격된 것 같습니다.", role={170}, name="파문제자", item={1,5,18,111}, itemNum=1, money=300},
    {id=17, diff="2", talk="형산파에서 파문당한 제자를 수배하고 있는데, 근처에서 목격된 것 같습니다.", role={179}, name="파문제자", item={1,3,18,111}, itemNum=1, money=300},
    {id=18, diff="2", talk="항산파에서 파문당한 제자를 수배하고 있는데, 근처에서 목격된 것 같습니다.", role={190}, name="파문제자", item={1,8,12,111}, itemNum=1, money=300},
    {id=19, diff="2", talk="숭산파에서 파문당한 제자를 수배하고 있는데, 근처에서 목격된 것 같습니다.", role={199}, name="파문제자", item={1,3,18,111}, itemNum=1, money=300},
    {id=20, diff="2", talk="태산파에서 파문당한 제자를 수배하고 있는데, 근처에서 목격된 것 같습니다.", role={210}, name="파문제자", item={1,3,18,111}, itemNum=1, money=300},
    {id=21, diff="4", talk="청성산에서 파문당한 제자들이 무리를 지어 악행을 저지르고 있는데, 근처에서 목격된 것 같습니다.", role={220, 220, 220, 220, 220, 220, 220, 220}, name="파문제자", item={1,3,18,111}, itemNum=1, money=500},
    {id=22, diff="4", talk="오독교 출신의 악적들이 악행을 저지르고 있는데, 근처에서 목격된 것 같습니다.", role={230, 230, 230, 230, 230, 230, 230, 230}, name="오독교도", item={1,3,18,111}, itemNum=1, money=500},
    {id=23, diff="4", talk="일월교 출신의 악적들이 악행을 저지르고 있는데, 근처에서 목격된 것 같습니다.", role={240, 240, 240, 240, 240, 240, 240, 240}, name="일월교도", item={1,3,18,111}, itemNum=1, money=500},
    {id=24, diff="4", talk="천산파 출신의 악적들이 악행을 저지르고 있는데, 근처에서 목격된 것 같습니다.", role={250, 250, 250, 250, 250, 250, 250, 250}, name="천산제자", item={1,3,18,111}, itemNum=1, money=500},
    {id=25, diff="4", talk="성수파에서 파문당한 제자들이 무리를 지어 악행을 저지르고 있는데, 근처에서 목격된 것 같습니다.", role={270, 270, 270, 270, 270, 270, 270, 270}, name="파문제자", item={1,3,18,111}, itemNum=1, money=500},
    {id=26, diff="4", talk="개방에서 파문당한 제자들이 무리를 지어 악행을 저지르고 있는데, 근처에서 목격된 것 같습니다.", role={280, 280, 280, 280, 280, 280, 280, 280}, name="파문제자", item={1,3,18,111}, itemNum=1, money=500},
    {id=27, diff="4", talk="철장파에서 파문당한 제자들이 무리를 지어 악행을 저지르고 있는데, 근처에서 목격된 것 같습니다.", role={290, 290, 290, 290, 290, 290, 290, 290}, name="파문제자", item={1,3,18,111}, itemNum=1, money=500},
    {id=28, diff="4", talk="전진교에서 파문당한 제자들이 무리를 지어 악행을 저지르고 있는데, 근처에서 목격된 것 같습니다.", role={300, 300, 300, 300, 300, 300, 300, 300}, name="파문제자", item={1,3,18,111}, itemNum=1, money=500},
    {id=29, diff="4", talk="소림사에서 파문당한 제자들이 무리를 지어 악행을 저지르고 있는데, 근처에서 목격된 것 같습니다.", role={90, 90, 90, 90, 90, 90, 90, 90}, name="파문제자", item={1,3,18,111}, itemNum=1, money=500},
    {id=30, diff="4", talk="신룡교 출신의 악적들이 악행을 저지르고 있는데, 근처에서 목격된 것 같습니다.", role={110, 110, 110, 110, 110, 110, 110, 110}, name="신룡교도", item={1,3,18,111}, itemNum=1, money=500},
    {id=31, diff="5", talk="근처에서 대마두를 목격했습니다. 무고한 사람들이 다치지 않도록 서둘러 처치해야 할 것 같습니다.", role={72}, name="대마두", item={19,20,28,32}, itemNum=1, money=800},
    {id=32, diff="5", talk="근처에서 대마두를 목격했습니다. 무고한 사람들이 다치지 않도록 서둘러 처치해야 할 것 같습니다.", role={64}, name="대마두", item={19,20,28,32}, itemNum=1, money=800},
    {id=33, diff="5", talk="근처에서 대마두를 목격했습니다. 무고한 사람들이 다치지 않도록 서둘러 처치해야 할 것 같습니다.", role={60}, name="대마두", item={19,20,28,32}, itemNum=1, money=800},
    {id=34, diff="5", talk="근처에서 대마두를 목격했습니다. 무고한 사람들이 다치지 않도록 서둘러 처치해야 할 것 같습니다.", role={27}, name="대마두", item={19,20,28,32}, itemNum=1, money=800},
    {id=35, diff="5", talk="근처에서 대마두를 목격했습니다. 무고한 사람들이 다치지 않도록 서둘러 처치해야 할 것 같습니다.", role={30}, name="대마두", item={19,20,28,32}, itemNum=1, money=800},
    {id=36, diff="5", talk="근처에서 대마두를 목격했습니다. 무고한 사람들이 다치지 않도록 서둘러 처치해야 할 것 같습니다.", role={72}, name="대마두", item={19,20,28,32}, itemNum=1, money=800},
    {id=37, diff="5", talk="근처에서 대마두를 목격했습니다. 무고한 사람들이 다치지 않도록 서둘러 처치해야 할 것 같습니다.", role={64}, name="대마두", item={19,20,28,32}, itemNum=1, money=800},
    {id=38, diff="5", talk="근처에서 대마두를 목격했습니다. 무고한 사람들이 다치지 않도록 서둘러 처치해야 할 것 같습니다.", role={60}, name="대마두", item={19,20,28,32}, itemNum=1, money=800},
    {id=39, diff="5", talk="근처에서 대마두를 목격했습니다. 무고한 사람들이 다치지 않도록 서둘러 처치해야 할 것 같습니다.", role={27}, name="대마두", item={19,20,28,32}, itemNum=1, money=800},
    {id=40, diff="5", talk="근처에서 대마두를 목격했습니다. 무고한 사람들이 다치지 않도록 서둘러 처치해야 할 것 같습니다.", role={30}, name="대마두", item={19,20,28,32}, itemNum=1, money=800},
}

TalkList = {
    "누구냐!",
    "왠 놈인냐",
    "호오.. 죽고싶은 게로구나!",
    "날 발견했으니 네 목숨을 가져가야겠다!",
}

Quest = QuestList[1]

function ClearQuestMark()
    jyx2_ReplaceSceneObject("1000", "Encounter/Quest/"..GetDiffString(Quest.id), "0");
end

function MakeQuest()
    id = math.random(1,40)
    Quest = QuestList[id]     
    return Quest
end

function GetQuest()
    return Quest
end

function GetDiffString(idx)
    if tonumber(QuestList[idx].diff) <= 1 then
        return "Easy"
    elseif tonumber(QuestList[idx].diff) <= 2 then
        return "Normal"
    elseif tonumber(QuestList[idx].diff) <= 4 then
        return "Hard"
    else 
        return "Impossible"
    end
end

function GetDiffText(idx)
    if tonumber(QuestList[idx].diff) <= 1 then
        return "쉬움"
    elseif tonumber(QuestList[idx].diff) <= 2 then
        return "보통"
    elseif tonumber(QuestList[idx].diff) <= 4 then
        return "어려움"
    else 
        return "불가능"
    end
end

function QuestBattle(idx)
    print("quest battle called..")

    local level = GetRoleLevel(0)
    
    --动态构建一场战斗
    local battleConfig = CS.Jyx2.CsBattleConfig()
    
    battleConfig.Id = 9999 -- 아무거나 해도됨
    if (math.random(0, 1)) == 0 then
        battleConfig.MapScene = "Jyx2Battle_11"
    else
        battleConfig.MapScene = "Jyx2Battle_24"
    end
    battleConfig.Exp = 100 * (QuestList[idx].diff + 1) * 2  -- 획득 경험치
    battleConfig.Music = 5
    battleConfig.TeamMates = {0}    -- 팀원 선택 가능
    battleConfig.Enemies = {}
    battleConfig.AutoTeamMates = {-1}
    GenerateEnemies(level, battleConfig)
    print("create battle .."..level)

    return battleConfig
end

function GenerateEnemies(level, battleConfig)
    print("GenerateEnemies..")
    print(battleConfig.DynamicEnemies)
    battleConfig:InitForDynamicData()
    
    --最多8个敌人
    size = #(Quest.role)
    print("GenerateRole.."..size)
    for i=1, size do
        local role = GenerateRole(level, i)
        battleConfig.DynamicEnemies:Add(role)
        
        --如果在5关以前，则NPC没有道具（否则太难了）
        if(level < 10) then
            role.Items:Clear()
        end
    end
end


--根据等级，生成一个随机敌人
function GenerateRole(level, idx)
    local roleId = Quest.role[idx]
    local selectRole = CS.Jyx2.GameRuntimeData.Instance:GetRole(roleId)
    
    local role = selectRole:Clone()
    role:SetName(Quest.name)
    role:ResetItems()

    --把角色提升到现在关卡的等级
    -- while(role.Level < math.min(level, CS.GameConst.MAX_ROLE_LEVEL)) do
    --     role:LevelUp() 
    -- end

    --每10关，随机给角色增加一个技能
    -- for i = 0, math.max(level/10-1,0) do
    --     if(role.Wugongs.Count < 10) then
    --         local skillId = math.random(0,92)
    --         if(skillId == 75 or skillId == 76) then
                --do nothing
                --鳄鱼和蜘蛛的技能，会导致动作失效
    --         else
    --             role:LearnMagic(skillId)
    --         end    
    --     end
    -- end
    
    --角色技能提升
    -- for i = 0, role.Wugongs.Count - 1 do
    --     local skill = role.Wugongs[i]
        
        --每4关升1级技能等级（一级对应是100level）
        -- if(skill ~= nil and skill.Level < level * 25) then

            --随机提升技能等级，不超过上限
    --         skill.Level = math.min(math.random(skill.Level, level * 25), 900) 
    --     end
    -- end
    
    role:Recover()
    return role
end

function GetTalk()
    idx = math.random(1,4)
    return TalkList[idx]
end

function GetRandomPos(src)
    dst = src + math.random(-12000, 12000) / 1000
    return dst
end

do return end